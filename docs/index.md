# 创蓝前端脚手架 CL253-LI

## 背景

前端技术栈日新月异，不管Vue, React, Angular是否最终分得三分天下。前端工程化的诞生衍生出了各种脚手架的诞生，所谓的脚手架就是把日常重复繁琐的事和项目没有关联性的工作用一个架子去实现。创蓝的项目很多，公司在不断的试错和创新中，但是大部分项目页面布局已经形成了一套固定的模式。找一个适用的脚手架很重要，对比了目前市场上排名靠前的react脚手架，Create React App , UmiJS , Ant Design Pro, Dva 每一个框架都很好，但依旧感觉臃肿，修改配置不方便。很多配置，依旧需要重复去做，每个框架可用，但不适用。创蓝需要自己的脚手架。

设计的脚手架能够满足公司大部分项目，既要适用于统一平台的微前端架构，还有要有独立创建的项目能力，而且配置项更符合创蓝前端的操作习惯。脚手架生成的项目能够完成项目初期所有的配置，但也不能把冗余的布局加进来，所以 `cl253-cli` 创蓝自己的脚手架就诞生了。

## 结构

cl253-cli 主要分为编译器 `cl-scripts` , 构建器 `cl253-cli` 和模板 `template` .
* `cl-scripts`负责React项目的webpack编译
* `cl253-cli`在创建新项目时的构建器，在项目初期建设时有用
* `template` 项目构建时克隆的项目模板，包含各种项目类型

### 构建器

构建器主要负责项目初期目录创建，模板类型选择，技术栈选择等初始化个功能，也是脚手架的本身具备的基础能力。
基本流程分别是：询问->记录配置->根据配置选择模板->创建临时模板->修改模板配置->删除临时模板。

构建器主要采用“commander”和“inquirer"两个插件的能力。Commander通过编写代码来描述你的命令行界面。 负责将参数解析为选项和命令参数，为问题显示使用错误，并实现一个有帮助的系统。inquirer主要实现问答功能，通过选项或者回答等个功能记录配置，再通过配置完成其他交互。

### 编译器

编译器是react项目中的webpack工程化配置的功能提炼。在日常的react项目中，尤其单页面项目，webpack工程配置已经是完全不能省略的步骤。但是webpack工程的能力几乎是固定的，大部分项目只要支撑2个能力，本地开发devserve能力，还有一个就是build打包构建生产环境资源的能力。在脚手架V1版本中，我们把编译器能力放置到模板里的，后期发现一个问题。当webpack等插件不断升级，老的项目需要调整时就要一个个项目的调整，一个个插件就行修复。但是webpack工程化是和项目本身是无太大关联性的。所以在V2版本中，把编译器”cl-scripts`“能力提起出来，做成一个插件，模板中引用插件。当webpack配置化升级时，我们主要通过修改编译器就好。

### 模板

模板是整个脚手架的可扩展项，目前已经支持的有 `独立React项目` 和 `微前端-微应用` 两套模板。后期可以根据需要不断的升级模板，扩展模板。比如只支撑TS的react项目，微前端主工程模板等等。通过模板的不断扩展，构建器和编译器都可以做相应的调整。

## 快速使用

可以通过 `npx cl253-cli <项目名称>` 直接线上创建项目，也可以 `npm i cl253-cli -g` 先本地安装再通过如下命令创建项目

```
cl253-cli <项目名称>
cd <项目目录>  // 打开创建的项目目录
npm i   //安装依赖
npm run dev // 启动项目
```

`npx cl253-cli <项目名称>` 推荐，这样在cl253-cli脚手架被更新后，可以直接通过最新版安装新项目。但是缺点是需要每次线上拉取脚手架资源，速度没有本地安装后创建。

下图为使用脚手架的截图：

<img src="https://static.253.com/images/brower/cl253-cli1.png" width="420">

也通过 `cl253-cli -H` 查看更多的命令：

```
Usage: cl253-cli [options] [project-directory]

命令示例：cl253-cli myapp

Options:
  -V, --version           脚手架当前版本
  -T, --temp <template>'  从下列项目类型中选择一个: 
                          spa 独立react单页面项目 
                          sspa-main 微前端-main主工程项目 
                          sspa-app 微前端-react微应用 
                          
  -H, --help              帮助信息
```

## 优势

* 命令行采用中文的交互，对英文不是很好的人有简单的阅读体验
* 构建或者编译过程采用可区分的色块提示，重点更突出
* 编译过程中采用进度条控制，摆脱编译内容沾满整个屏幕的问题
* 可扩展的模板类型，可以方便的拔插你需要的模板
* 独立出编译器能力，方便后续统一升级，业务层更聚焦业务逻辑本身
* 独立的配置文件app.config.js，方便配置一些和项目有关的配置项。
